/*! For license information please see echarts-a11y-plugin.umd.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.EChartsAccessibilityPlugin=e():t.EChartsAccessibilityPlugin=e()}(Object("undefined"!=typeof self?self:this),()=>(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function i(t,e={}){this.chart=t,this.opts={chartId:"chart",tableWrapperId:"table-wrapper",tableBodyId:"table-body",backButtonId:"back-to-chart",srLiveId:"sr-live",enableTableView:!0,enableLegendNav:!0,enableDecal:!1,onDataSelect:null,locale:null,i18n:{},...e},this.container=t.getDom(),this.state={ready:!1,mode:"data",dataIndex:-1,seriesIndex:0,legendIndex:-1,tooltipVisible:!1},this._cachedOption=null,this._boundKey=this._onKeyDown.bind(this),this._boundBlur=this._onBlur.bind(this),this.chart.on("finished",()=>{if(this.state.ready)return this._cachedOption=null,void this._setupContainer();this.state.ready=!0,this._init()})}t.d(e,{default:()=>a});const n=i.prototype;var s={ariaLabel:"{type} chart, {seriesCount} series, {dataCount} data points. Arrow keys to navigate, H for help.",noData:"No data in this series",onlySeries:"Only one series",point:"Point {index} of {total}. {category}: {value} ({series})",pointNoSeries:"Point {index} of {total}. {category}: {value}",selected:"Selected: {value}",noPointSelected:"No point selected — use arrow keys first",seriesLabel:"Series {index} of {total}: {name}",noLegendItems:"No legend items",legendItem:"Legend {index} of {total}: {name}. Press Enter to toggle.",legendToggled:"{name} toggled",dataMode:"Data mode",tooltipDismissed:"Tooltip dismissed",navigationCleared:"Navigation cleared",returnedToData:"Returned to data navigation",tableView:"Table view. Tab to read data. Press T or Escape to return to chart.",tableHint:"Table view — Press T or Esc to return to chart",tableAriaLabel:"Data table view",backButton:"← Back to Chart",chartView:"Chart view",rowFallback:"Row {index}",categoryFallback:"Category",seriesFallback:"Series {index}",unnamed:"Unnamed",help:"← → navigate points. ↑ ↓ switch series. L legend mode. T table view. Enter select. Escape dismiss or exit. Home End first or last."};n._t=function(t,e){var n=this.opts.locale&&i.locales[this.opts.locale]||{},a=this.opts.i18n[t]??n[t]??s[t]??t;if(e)for(var o in e)a=a.split("{"+o+"}").join(null!=e[o]?e[o]:"");return a},n._init=function(){this._setupContainer(),this._setupAria(),this._setupLiveRegion(),this.opts.enableTableView&&this._initTableView(),this.container.addEventListener("keydown",this._boundKey),this.container.addEventListener("blur",this._boundBlur),this.chart.on("legendselectchanged",()=>{this._cachedOption=null})},n._setupLiveRegion=function(){var t=document.getElementById(this.opts.srLiveId);if(t)this._liveRegion=t;else{var e=document.createElement("div");e.id=this.opts.srLiveId,e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0",document.body.appendChild(e),this._liveRegion=e}},n._setupContainer=function(){this.container.setAttribute("tabindex","0"),this.container.setAttribute("role","application"),this.container.setAttribute("aria-label",this._t("ariaLabel",{type:this._chartType(),seriesCount:this._seriesCount(),dataCount:this._dataLength()}))},n._setupAria=function(){this.chart.setOption({aria:{enabled:!0,decal:{show:this.opts.enableDecal}}})},n._option=function(){return this._cachedOption||(this._cachedOption=this.chart.getOption()),this._cachedOption},n._usesDataset=function(){const t=this._option().dataset&&this._option().dataset[0]&&this._option().dataset[0].source;return Array.isArray(t)&&t.length>0},n._isRowLayout=function(){return(this._option().series||[]).some(function(t){return"row"===t.seriesLayoutBy})},n._datasetSource=function(){const t=this._option().dataset&&this._option().dataset[0]&&this._option().dataset[0].source||[];return Array.isArray(t)&&1===t.length&&Array.isArray(t[0])&&"object"==typeof t[0][0]?t[0]:t},n._encodeY=function(t){const e=this._option().series&&this._option().series[t]&&this._option().series[t].encode&&this._option().series[t].encode.y;return Array.isArray(e)?e[0]:null!=e?e:null},n._encodeX=function(t){const e=this._option().series&&this._option().series[t]&&this._option().series[t].encode&&this._option().series[t].encode.x;return Array.isArray(e)?e[0]:null!=e?e:null},n._dataLength=function(t){if(void 0===t&&(t=this.state.seriesIndex),this._usesDataset()){if(this._isRowLayout()){const t=this._datasetSource();return t.length>0?t[0].length-1:0}return this._datasetSource().length}return this._seriesDataInline(t).length},n._dataPoint=function(t,e){if(void 0===e&&(e=this.state.seriesIndex),this._usesDataset()){if(this._isRowLayout()){const i=this._datasetSource()[e+1];return null!=i?i[t+1]:null}const i=this._datasetSource()[t],n=this._encodeY(e);return null==i?null:Array.isArray(i)?null!=n?i[n]:i[1]:null!=n?i[n]:null}const i=this._seriesDataInline(e)[t];return void 0!==i?i:null},n._categoryAt=function(t){if(this._usesDataset()){if(this._isRowLayout()){const e=this._datasetSource(),i=e.length>0?e[0][t+1]:null;return null!=i?i:this._t("rowFallback",{index:t+1})}const e=this._datasetSource()[t];if(null==e)return this._t("rowFallback",{index:t+1});const i=null!=this._encodeX(0)?this._encodeX(0):this._encodeX(this.state.seriesIndex);return Array.isArray(e)?null!=i?e[i]:e[0]:null!=i?e[i]:Object.values(e)[0]}const e=this._option(),i=e.xAxis&&(e.xAxis[0]?e.xAxis[0].data:e.xAxis.data)||[];return null!=i[t]?i[t]:this._t("rowFallback",{index:t+1})},n._seriesDataInline=function(t){void 0===t&&(t=this.state.seriesIndex);const e=this._option().series&&this._option().series[t]&&this._option().series[t].data;return e?Array.isArray(e)&&1===e.length&&Array.isArray(e[0])?e[0]:Array.isArray(e)?e:[]:[]},n._valueOf=function(t){return null==t?"N/A":"object"!=typeof t?t:null!=t.value?t.value:null!=t[1]?t[1]:null!=t[0]?t[0]:"N/A"},n._chartType=function(){return this._option().series&&this._option().series[0]&&this._option().series[0].type||"data"},n._seriesCount=function(){return this._option().series&&this._option().series.length||0},n._legendNames=function(){if(this._usesDataset()){if(this._isRowLayout()){const t=this._datasetSource();return(this._option().series||[]).map(function(e,i){var n=t[i+1]&&t[i+1][0];return null!=n?String(n):null!=e.name?String(e.name):this._t("seriesFallback",{index:i+1})}.bind(this))}return(this._option().series||[]).map(function(t,e){return null!=t.name?String(t.name):this._t("seriesFallback",{index:e+1})}.bind(this))}const t=this._option();return(t.legend&&(t.legend[0]?t.legend[0].data:t.legend.data)||[]).map(function(t){return"object"==typeof t?t.name:t}).filter(Boolean)},n._onKeyDown=function(t){if(document.activeElement===this.container){var e=this,i={ArrowLeft:function(){e._arrowH(-1)},ArrowRight:function(){e._arrowH(1)},ArrowUp:function(){e._arrowV(-1)},ArrowDown:function(){e._arrowV(1)},Enter:function(){e._activate()}," ":function(){e._activate()},Escape:function(){e._escape()},Home:function(){e.jumpToFirst()},End:function(){e.jumpToLast()},l:function(){e._toggleLegendMode()},L:function(){e._toggleLegendMode()},t:function(){e.toggleTableView()},T:function(){e.toggleTableView()},h:function(){e.help()},H:function(){e.help()}}[t.key];i&&(t.preventDefault(),i())}},n._arrowH=function(t){"legend"===this.state.mode?this._navigateLegend(t):this._navigateData(t)},n._arrowV=function(t){"legend"!==this.state.mode&&this._navigateSeries(t)},n._activate=function(){"legend"===this.state.mode?this._toggleLegendItem():this._selectPoint()},n._escape=function(){this.state.tooltipVisible?(this._hideTip(),this._announce(this._t("tooltipDismissed"))):"data"!==this.state.mode?(this._setMode("data"),this._announce(this._t("returnedToData"))):(this._clearHighlight(),this.state.dataIndex=-1,this._announce(this._t("navigationCleared")))},n._onBlur=function(){var t=this;setTimeout(function(){var e=t._tableWrapper&&t._tableWrapper.contains(document.activeElement);t.container.matches(":focus")||e||(t._clearHighlight(),t._hideTip(),t.state.dataIndex=-1,t.state.legendIndex=-1)},100)},n._navigateData=function(t){if(this.state.ready){var e=this._dataLength();0!==e?(this._clearHighlight(),this.state.dataIndex=this.state.dataIndex<0?t>0?0:e-1:(this.state.dataIndex+t+e)%e,this._highlight(),this._showTip(),this._announcePoint()):this._announce(this._t("noData"))}},n._navigateSeries=function(t){if(this.state.ready){var e=this._seriesCount();if(e<=1)this._announce(this._t("onlySeries"));else{this._clearHighlight(),this.state.seriesIndex=(this.state.seriesIndex+t+e)%e,this._cachedOption=null,this.state.dataIndex>=0&&(this.state.dataIndex=Math.min(this.state.dataIndex,this._dataLength()-1),this._highlight(),this._showTip());var i=this._option().series[this.state.seriesIndex]&&this._option().series[this.state.seriesIndex].name||this._t("unnamed");this._announce(this._t("seriesLabel",{index:this.state.seriesIndex+1,total:e,name:i}))}}},n._toggleLegendMode=function(){this.opts.enableLegendNav&&("legend"===this.state.mode?(this._setMode("data"),this._announce(this._t("dataMode"))):(this._setMode("legend"),this.state.legendIndex<0&&(this.state.legendIndex=0),this._announceLegend()))},n._navigateLegend=function(t){var e=this._legendNames();e.length?(this.state.legendIndex=(this.state.legendIndex+t+e.length)%e.length,this._announceLegend()):this._announce(this._t("noLegendItems"))},n._toggleLegendItem=function(){var t=this._legendNames();if(!(this.state.legendIndex<0)&&t.length){var e=t[this.state.legendIndex];this.chart.dispatchAction({type:"legendToggleSelect",name:e}),this._cachedOption=null,this._announce(this._t("legendToggled",{name:e}))}},n._selectPoint=function(){if(this.state.dataIndex<0)this._announce(this._t("noPointSelected"));else{this.chart.dispatchAction({type:"select",seriesIndex:this.state.seriesIndex,dataIndex:this.state.dataIndex});var t=this._valueOf(this._dataPoint(this.state.dataIndex));this._announce(this._t("selected",{value:t})),this.opts.onDataSelect&&this.opts.onDataSelect({seriesIndex:this.state.seriesIndex,dataIndex:this.state.dataIndex,value:t})}},n._showTip=function(){this.chart.dispatchAction({type:"showTip",seriesIndex:this.state.seriesIndex,dataIndex:this.state.dataIndex}),this.state.tooltipVisible=!0},n._hideTip=function(){this.chart.dispatchAction({type:"hideTip"}),this.state.tooltipVisible=!1},n._highlight=function(){this.chart.dispatchAction({type:"highlight",seriesIndex:this.state.seriesIndex,dataIndex:this.state.dataIndex})},n._clearHighlight=function(){this.state.dataIndex>=0&&this.chart.dispatchAction({type:"downplay",seriesIndex:this.state.seriesIndex,dataIndex:this.state.dataIndex}),this._hideTip()},n.jumpToFirst=function(){this.state.ready&&0!==this._dataLength()&&(this._clearHighlight(),this.state.dataIndex=0,this._highlight(),this._showTip(),this._announcePoint())},n.jumpToLast=function(){if(this.state.ready){var t=this._dataLength();0!==t&&(this._clearHighlight(),this.state.dataIndex=t-1,this._highlight(),this._showTip(),this._announcePoint())}},n.help=function(){this._announce(this._t("help"))},n.destroy=function(){this.container.removeEventListener("keydown",this._boundKey),this.container.removeEventListener("blur",this._boundBlur),this._clearHighlight(),this._tableWrapper&&this._tableWrapper.remove(),this._liveRegion&&this._liveRegion.id===this.opts.srLiveId&&this._liveRegion.remove()},n._initTableView=function(){var t=this,e=document.createElement("div"),i=this.opts.backButtonId,n=this.opts.tableBodyId;e.id=this.opts.tableWrapperId,e.setAttribute("role","region"),e.setAttribute("aria-label",this._t("tableAriaLabel")),e.style.display="none",e.innerHTML='<div class="table-header"><p>'+this._t("tableHint")+'</p><button id="'+i+'">'+this._t("backButton")+'</button></div><div id="'+n+'"></div>',this.container.parentNode.insertBefore(e,this.container.nextSibling),this._tableWrapper=e,this._tableBody=document.getElementById(n),e.querySelector("#"+i).addEventListener("click",function(){t._showChart()}),e.addEventListener("keydown",function(e){"Escape"!==e.key&&"t"!==e.key&&"T"!==e.key||(e.preventDefault(),t._showChart())})},n.toggleTableView=function(){this.opts.enableTableView&&("table"===this.state.mode?this._showChart():this._showTable())},n._showTable=function(){this._setMode("table"),this._renderTable(),this.container.style.display="none",this._tableWrapper.style.display="block",this._tableWrapper.querySelector("button").focus(),this._announce(this._t("tableView"))},n._showChart=function(){this._setMode("data"),this.container.style.display="block",this._tableWrapper.style.display="none",this.container.focus(),this._announce(this._t("chartView"))},n._renderTable=function(){var t,e=this._option(),i=this,n=e.series||[],s=this._legendNames();if(this._usesDataset()&&this._isRowLayout()){var a=this._datasetSource();t=a.length>0&&null!=a[0][0]?String(a[0][0]):this._t("categoryFallback")}else{if(!(t=e.xAxis&&(e.xAxis[0]?e.xAxis[0].name:e.xAxis.name))&&this._usesDataset()){var o=this._encodeX(0);t=null!=o?String(o):this._t("categoryFallback")}t=t||this._t("categoryFallback")}var r=this._dataLength(),h='<table class="echarts-data-table"><thead><tr>';h+='<th scope="col">'+t+"</th>",n.forEach(function(t,e){h+='<th scope="col">'+(s[e]||i._t("seriesFallback",{index:e+1}))+"</th>"}),h+="</tr></thead><tbody>";for(var l=0;l<r;l++)h+='<tr><th scope="row">'+i._categoryAt(l)+"</th>",n.forEach(function(t,e){h+="<td>"+i._valueOf(i._dataPoint(l,e))+"</td>"}),h+="</tr>";h+="</tbody></table>",this._tableBody.innerHTML=h;var d=this._tableBody.querySelector("table");d&&d.setAttribute("tabindex","0")},n._announcePoint=function(){var t=this.state.dataIndex,e=this._valueOf(this._dataPoint(t)),i=this._categoryAt(t),n=this._dataLength(),s=this._option().series&&this._option().series[this.state.seriesIndex]&&this._option().series[this.state.seriesIndex].name;this._announce(null!=s?this._t("point",{index:t+1,total:n,category:i,value:e,series:s}):this._t("pointNoSeries",{index:t+1,total:n,category:i,value:e}))},n._announceLegend=function(){var t=this._legendNames();this._announce(this._t("legendItem",{index:this.state.legendIndex+1,total:t.length,name:t[this.state.legendIndex]}))},n._announce=function(t){var e=this._liveRegion;e&&(e.textContent="",requestAnimationFrame(function(){e.textContent=t}))},n._setMode=function(t){this.state.mode=t},i.locales={},i.registerLocale=function(t,e){i.locales[t]=e};const a=i;return e.default})());